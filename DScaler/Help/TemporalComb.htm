<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
<!-- #BeginTemplate "/Templates/dtvnormal.dwt" -->
<head>
<!-- #BeginEditable "doctitle" -->
<title>DScaler &mdash; Temporal Comb Filter</title>
<!-- #EndEditable -->
<meta http-equiv="Content-Type" content=
"text/html; charset=iso-8859-1">
<style type="text/css">
<!--
p {  font-family: Arial, Helvetica, sans-serif; font-size: 10pt}
.bottommenu {  font-family: Arial, Helvetica, sans-serif; font-size: 8pt; font-style: normal; text-decoration: none}
h3 {  font-family: Arial, Helvetica, sans-serif; font-size: 10pt; font-style: normal; font-weight: bold}
h1 {  font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 18pt; font-weight: bold}
li {  font-family: Arial, Helvetica, sans-serif; font-size: 10pt}
h2 {  font-family: Arial, Helvetica, sans-serif; font-size: 14pt; font-weight: bold}
ol {  font-family: Arial, Helvetica, sans-serif; font-size: 10pt}
blockquote {  font-family: Arial, Helvetica, sans-serif; font-size: 10pt}
pre {  font-family: "Courier New", Courier, mono; font-size: 9pt}
ul {  font-family: Arial, Helvetica, sans-serif; font-size: 10pt}
-->
</style>
</head>
<body bgcolor="#FFFFFF">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td height="1" width="160"><img src="images/spacer.gif" width="1"
height="1"></td>
<td height="1" width="342"><img src="images/spacer.gif" width="1"
height="1"></td>
<td height="1" width="501"><img src="images/spacer.gif" width="1"
height="1"></td>
</tr>

<tr>
<td width="160"><img src="images/dscalerlogo.jpg" alt=
"DScaler Logo"></td>
<td colspan="2" align="right" valign="bottom"><font face=
"Verdana, Arial, Helvetica, sans-serif" size="5"><b>
<!-- #BeginEditable "Page%20Title" -->
Temporal Comb Filter
<!-- #EndEditable --></b></font></td>
</tr>

<tr bgcolor="#FFCC00" align="right">
<td colspan="3"><img src="images/yellowspacer.gif" width="100%"
height="2"></td>
</tr>

<tr>
<td colspan="3"> </td>
</tr>

<tr>
<td colspan="3">
<!-- #BeginEditable "Text" -->

<p>
This filter removes dot crawl and some kinds of shim&shy;mering.
The effect is most notic&shy;able on com&shy;puter gener&shy;ated images like
sub&shy;titles, weather maps, and sta&shy;tion logos using a compos&shy;ite
video signal.  Normal compos&shy;ite video is more subtly improved.
</p> 

<HR>

<p><b><font face="Arial" size="4">
Who Should Use It?
</font></b></p>

<p>
The <A HREF="#Comb Explanation">comb filter</A> is pretty slow, requir&shy;ing roughly 350 MHz of proces&shy;sor time. So
unless you&rsquo;ve got a Pentium 3, Athlon, or better, it&rsquo;s prob&shy;ably not worth the cost.
</p>

<p>
If your computer is fast enough, you should run the comb filter
when&shy;ever you&rsquo;re watch&shy;ing a compos&shy;ite signal.  That&rsquo;s
what you have if you&rsquo;re using an internal TV tuner or an RCA con&shy;nector.
It also helps very slightly with shim&shy;mering from an S-Video sig&shy;nal&nbsp;&mdash; but you can prob&shy;ably find
some&shy;thing more produc&shy;tive to keep your processor busy.
</p>

<p>
The comb filter helps a great deal with games for recent con&shy;soles such as the
PS2&nbsp;&mdash; but it doesn&rsquo;t do a thing for video from older con&shy;soles
like the Super Nin&shy;tendo or original Play&shy;Station.  To get rid of
color cross&shy;talk from older consoles, turn off this filter and use
the <A HREF="OldGame.htm">Old Game</A> de&shy;interlac&shy;er, instead.
</p>

<HR>

<p><b><font face="Arial" size="4">
The Settings
</font></b></p>

<p>
I&rsquo;m going to describe how to config&shy;ure this filter
conserva&shy;tively, so you can forget about it after&shy;ward. If you like
to fiddle with sliders, you can instead use much more ag&shy;gres&shy;sive
set&shy;tings (lower <font color = "#993300">Recall</font> and
<font color = "#993300">Shim&shy;mering</font> values) and turn them up
only when you have to.
</p>

<p><A NAME="Recall"><b><font face="Arial" font color = "#993300">
Recall of past shim&shy;mering
</font></b></A></p>

<p>
This is the really impor&shy;tant setting. It decides just how far
back into the past the filter will look in order to confirm that
there&rsquo;s really some shim&shy;mering going on. Set it high (above 75%)
to avoid artifacts in scenes with repeti&shy;tive motion. But don&rsquo;t
set it too high (above 95%), or it&rsquo;ll take a long time for the
filter to kick in.
</p>

<P>
When you change this setting, it&rsquo;ll take a moment before the
screen can adjust.  Really high set&shy;tings (above 90%) need especially
long to take.
</P>

<p><A NAME="Shimmering"><b><font face="Arial" font color = "#993300">
Shimmering to activate
</font></b></A></p>

<p>
This setting has a much subtler effect. If you set it high,
the filter will only correct when there has been uninter&shy;rupted
shim&shy;mering. Set it low, and the filter will tolerate more
inter&shy;ruptions&nbsp;&mdash; but will also be a little more suscep&shy;tible to
artifacts.
</p>

<p>
If you&rsquo;re running a noise filter, too, you can afford to set
this low&nbsp;&mdash; 30% works well for me. That&rsquo;s a good idea, since it
will allow the filter to correct more subtle shim&shy;mering. Without
a noise filter, you&rsquo;ll need to set it pretty high (about 70%) to
avoid tran&shy;sient spots where dot crawl has just disap&shy;peared. If
you don&rsquo;t care about shim&shy;mering and just want to take care of dot
crawl, you can safely set this near 100%.
</p>

<p><A NAME="ColorDifferences"><b><font face="Arial" font color = "#993300">
Maximum color variation
</font></b></A></p>

<p>
This option lets you choose just how much the color can change
before the filter decides the dif&shy;ference must be due to
motion. It can be set much higher than the thresholds in the <A HREF="Noise.htm">Tempo&shy;ral Noise
Filter</A>, since this filter uses a stricter motion detec&shy;tion
method. If you&rsquo;ve enabled Even Luma Peaking and Odd Luma Peaking
(in the Advanced Video Flags dialog), you&rsquo;ll need to set this
very high&nbsp;&mdash; to 45 or 50. With peaking dis&shy;abled, you can
drop this setting to around 35. You can lower it by about 10 points 
if you turn on <font color = "#993300">Trade Speed for Accuracy</font>.
</p>

<p>
The higher you set this, the more likely you
are to see tran&shy;sient spots. So if you set this really high,
you&rsquo;ll want to increase <font color = "#993300">Recall</font>
and/or <font color = "#993300">Shim&shy;mering</font>.
</p>

<P>
There isn&rsquo;t an intuitive way to choose the <font color = "#993300">Maximum color varia&shy;tion</font>,
so here&rsquo;s a guide to help you set it:
</P>

<UL>
<LI>
First, tune in the worst dot crawl you can find. In the US,
CNN Head&shy;lines is a depend&shy;able source, as are the &ldquo;T&rdquo; in the
Coun&shy;try Music Sta&shy;tion&rsquo;s logo and the radar maps on the Weather
Chan&shy;nel. If you&rsquo;ve got a video refer&shy;ence DVD, con&shy;nect it via
compos&shy;ite and show a still with neigh&shy;boring green and magenta
color bars.

<LI>
Turn <font color = "#993300">Recall</font> and <font color = "#993300">Shim&shy;mering</font> all the way down.
Turn <font color = "#993300">Max&shy;imum color varia&shy;tion</font> up really high (to about 80).
The dot crawl should dis&shy;appear. (Well, bad dot crawl does still
leave a resid&shy;ual shim&shy;mer unless you enable <font color = "#993300">Trade Speed for
Accuracy</font>.)

<LI>
Move <font color = "#993300">Max&shy;imum color varia&shy;tion</font> down until the dot crawl
returns. Then raise it until the dot crawl dis&shy;appears,
again. You&rsquo;ve now got your&shy;self the best value for it.

<LI>
Turn <font color = "#993300">Recall</font> and
<font color = "#993300">Shim&shy;mering</font> back up to more reason&shy;able
values.
</UL>

<p><A NAME="SpeedForAccuracy"><b><font face="Arial" font color = "#993300">
Trade speed for accuracy
</font></b></A></p>

<p>
This checkbox does pretty much what it says. It improves the
accuracy and colors&nbsp;&mdash; but slows things down, and uses an
addi&shy;tional 2 MB of memory (on top of the ~400K it always needs).
</p>

<P>
As with <font color = "#993300">Recall</font>, you&rsquo;ll need to wait a
moment before this setting takes effect.
</P>

<p><b><font face="Arial">
Looking for trouble
</font></b></p>

<p>
If you want to find artifacts to help you pick set&shy;tings, there
are a couple types of mater&shy;ial which are especially prob&shy;lematic.
Strobe effects in music videos may cause fits. But the very worst
case is the ticker tape on CNBC (on US Cable), which goes by at
the right speed to fool the filter. Worse yet, it has bad (but
moving) dot crawl. You&rsquo;ll need to set the
<font color = "#993300">Recall</font> option pretty
high (about 85%) to avoid prob&shy;lems with it.
</p>

<HR>

<p><b><A NAME="Comb Explanation"><font face="Arial" size="4">
What the heck is a comb filter?
</font></A></b></p>

<P>
In technical terms, it
averages out chrom&shy;in&shy;ance/lum&shy;in&shy;ance cross&shy;talk caused by imperfect
separ&shy;ation from a compos&shy;ite signal. It&rsquo;s called a &ldquo;comb&rdquo; for a
really obscure reason&nbsp;&mdash; because the fre&shy;quency response looks a
(very little) bit like a comb. Appar&shy;ently, signal proces&shy;sing
engi&shy;neers are obses&shy;sed with grooming.
</p>

<TABLE width="100%" border=0>
<TBODY>
<TR><TD>
<img src="images/TComb_Off_CNN.JPG" width="50%" align=right alt="CNN without Temporal Comb">
<p>
Here&rsquo;s an
ex&shy;ample of the prob&shy;lem, taken from a US Cable TV broad&shy;cast with an in&shy;ter&shy;nal tuner. There&rsquo;s
heavy dot crawl in the weath&shy;er map and CNN logo, and more subtle color prob&shy;lems
in and around the text. On your screen, those dots would seem to be mov&shy;ing slow&shy;ly up&shy;ward. &rarr;
</p>
<P>
(Try to ignore the JPEG artifacts.)
</p>
<TR><TD><BR>
<img src="images/TComb_On_CNN.JPG" width="50%" align=right alt="CNN with Temporal Comb">
<p>
And here&rsquo;s the
ef&shy;fect of the Tem&shy;por&shy;al Comb Fil&shy;ter on the same (well, a real&shy;ly simi&shy;lar) pic&shy;ture. This was
taken with the de&shy;fault set&shy;tings. &rarr;
</p>
<TR><TD><BR>
<TR><TD>
<img src="images/TComb_Off_Jack.JPG" width="134" height="202" align=left alt="Jack without Temporal Comb">
<p>
The comb filter
also helps more subtly with edges in car&shy;toons and normal video. This
first pic&shy;ture shows &ldquo;Jack&rdquo; without fil&shy;ter&shy;ing. &larr; 
</p>
<TR><TD>
<img src="images/TComb_On_Jack.JPG" width="134" height="202" align = left alt="Jack with Temporal Comb">
<P>
...and here he
is with the comb fil&shy;ter enabled. Note the smooth&shy;er bound&shy;ary be&shy;tween his head/neck and the
back&shy;ground.  (Ig&shy;nore the stuff under his lip&nbsp;&mdash; it comes from the im&shy;age com&shy;pres&shy;sion.) This
pic&shy;ture was taken with <font color="#993300">Trade Speed for Ac&shy;cu&shy;ra&shy;cy</font> turned on. &larr; 
<BR>

</TR></TBODY></TABLE>


<p>
But this comb filter only works tempor&shy;ally, not spatial&shy;ly.  As a result,
it does not help with dot crawl and shim&shy;mering in moving
images.
</p>

<p>
Note that this filter is not in any way related to &ldquo;comb&rdquo; in
the sense used by many video folks! It&rsquo;s not sup&shy;posed to reduce
weave artifacts (lagging horizontal lines) at all.  For that,
you need to take a look at the <A HREF="Deinterlace.HTM">de&shy;interlac&shy;ing methods</A>.
</p>



<!-- #EndEditable -->
</td>
</tr>

<tr>
<td colspan="3"> </td>
</tr>

<tr>
<td colspan="3"></td>
</tr>

<tr>
<td colspan="3"> </td>
</tr>

<tr bgcolor="#FFCC00">
<td colspan="3">
<div align="center"><img src="images/yellowspacer.gif" width=
"100%" height="2"></div>
</td>
</tr>
</table>

<!-- #EndTemplate -->
</body>
</html>

